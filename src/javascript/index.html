<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculatrice Cassée - Réparation</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/tabs.css">
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                <div>
                    <h1>Calculatrice Cassée</h1>
                    <p class="subtitle">Votre mission : réparer cette calculatrice qui fait des erreurs !</p>
                </div>
                <div class="accessibility-controls" style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn-accessibility" onclick="decreaseFontSize()" title="Réduire la taille">A-</button>
                    <button class="btn-accessibility" onclick="increaseFontSize()" title="Augmenter la taille">A+</button>
                    <button class="btn-accessibility" onclick="toggleDarkMode()" title="Mode sombre/clair">☀</button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="test-panel">
                <h2>Tests de Validation</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn-test" onclick="runTests()">Lancer les Tests</button>
                    <button class="btn-export" onclick="exportTestResults()">Exporter les résultats</button>
                </div>
                <div id="test-results"></div>
                <div class="hints-section">
                    <h3>Indices</h3>
                    <button class="btn-hint" onclick="showHintForSelectedBug()">Obtenir un indice</button>
                    <div id="hints-container" class="hints-container"></div>
                </div>
                <div class="history-section">
                    <h3>Historique</h3>
                    <button class="btn-clear-history" onclick="clearHistory()">Effacer</button>
                    <div id="calculation-history" class="history-container"></div>
                </div>
                <div class="statistics-section">
                    <h3>Statistiques</h3>
                    <button class="btn-clear-stats" onclick="clearStats()">Effacer</button>
                    <div id="error-statistics" class="statistics-container"></div>
                </div>
            </div>

            <div class="calculator-wrapper">
                <div class="panel">
                    <h2>Calculatrice</h2>
                    <div class="calculator-container">
                        <!-- Onglets -->
                        <div class="calculator-tabs">
                            <button class="tab-button active" data-tab="calculator">Calculatrice</button>
                            <button class="tab-button" data-tab="console">Console (Code)</button>
                        </div>

                        <!-- Contenu onglet Calculatrice -->
                        <div class="tab-content active" id="tab-calculator">
                            <div class="calculator" id="calculator">
                                <div class="display" id="display">0</div>
                                <div class="buttons">
                                    <button class="btn advanced" onclick="calculateAdvanced('sin')">sin</button>
                                    <button class="btn advanced" onclick="calculateAdvanced('cos')">cos</button>
                                    <button class="btn advanced" onclick="calculateAdvanced('tan')">tan</button>
                                    <button class="btn advanced" onclick="calculateAdvanced('hyp')">hyp</button>
                                    
                                    <button class="btn clear" onclick="clearDisplay()">C</button>
                                    <button class="btn operator" onclick="appendOperator('/')">/</button>
                                    <button class="btn operator" onclick="appendOperator('*')">×</button>
                                    <button class="btn operator" onclick="appendOperator('%')">%</button>
                                    
                                    <button class="btn number" onclick="appendNumber('7')">7</button>
                                    <button class="btn number" onclick="appendNumber('8')">8</button>
                                    <button class="btn number" onclick="appendNumber('9')">9</button>
                                    <button class="btn operator" onclick="appendOperator('-')">-</button>
                                    
                                    <button class="btn number" onclick="appendNumber('4')">4</button>
                                    <button class="btn number" onclick="appendNumber('5')">5</button>
                                    <button class="btn number" onclick="appendNumber('6')">6</button>
                                    <button class="btn operator" onclick="appendOperator('+')">+</button>
                                    
                                    <button class="btn number" onclick="appendNumber('1')">1</button>
                                    <button class="btn number" onclick="appendNumber('2')">2</button>
                                    <button class="btn number" onclick="appendNumber('3')">3</button>
                                    <button class="btn equals" onclick="calculate()">=</button>
                                    
                                    <button class="btn number zero" onclick="appendNumber('0')">0</button>
                                    <button class="btn number" onclick="appendNumber('.')">.</button>
                                </div>
                            </div>
                        </div>

                        <!-- Contenu onglet Console (Code modifiable par l'utilisateur) -->
                        <div class="tab-content" id="tab-console">
                            <div class="code-console-editor">
                                <textarea id="code-editor" spellcheck="false"></textarea>
                                <div class="code-console-actions">
                                    <button class="btn-apply-code" type="button" onclick="applyUserCode()">Appliquer le code</button>
                                    <span class="code-status" id="code-status"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-panel">
            <h2>Instructions</h2>
            <p>Cette calculatrice a plusieurs bugs. Utilisez les tests pour identifier et corriger les erreurs dans le code JavaScript.</p>
            <p><strong>Objectif :</strong> Tous les tests doivent passer (✅) pour que la calculatrice soit considérée comme réparée.</p>
        </div>
    </div>

    <script src="js/calculator.js"></script>
    <script src="js/keyboard-support.js"></script>
    <script src="js/display-feedback.js"></script>
    <script src="js/hints-system.js"></script>
    <script src="js/calculation-history.js"></script>
    <script src="js/error-statistics.js"></script>
    <script src="js/accessibility-controls.js"></script>
    <script src="js/tests.js"></script>
    <script src="js/tabs.js"></script>
    <script>
        // Fonction pour obtenir un indice basé sur les tests qui échouent
        function showHintForSelectedBug() {
            const testResults = document.querySelectorAll('#test-results .test-item');
            const failedTests = [];
            
            testResults.forEach(test => {
                if (test.classList.contains('failed')) {
                    const testName = test.querySelector('.test-name')?.textContent || '';
                    failedTests.push(testName);
                }
            });
            
            if (failedTests.length === 0) {
                alert('Tous les tests passent ! Pas besoin d\'indices.');
                return;
            }
            
            // Prendre le premier test qui échoue
            const hint = getHintForFailedTest(failedTests[0]);
            if (!hint) {
                alert('Indice : Regarde les tests qui échouent pour identifier les bugs !');
            }
        }

        // Initialiser les onglets de la calculatrice et l'éditeur de code
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initTabs === 'function') {
                initTabs();
            }
            if (typeof initCodeEditor === 'function') {
                initCodeEditor();
            }
        });
    </script>
</body>
</html>

